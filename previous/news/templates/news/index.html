<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSAFY 뉴스 검색기 UI</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
            font-family: 'Noto Sans KR', sans-serif;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        .search-container {
            display: flex;
            align-items: center;
            background-color: #1a73e8;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .brand {
            display: flex;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            margin-right: 20px;
            white-space: nowrap;
        }

        .brand-icon {
            display: inline-block;
            width: 20px;
            height: 16px;
            background-color: #ccc;
            border-radius: 2px;
            margin-right: 8px;
            position: relative;
        }

        .brand-icon::after {
            content: '';
            position: absolute;
            top: 4px;
            left: 2px;
            width: 10px;
            height: 2px;
            background: #777;
            box-shadow: 0 4px 0 #777;
        }

        .search-input {
            flex-grow: 1;
            padding: 10px 15px;
            border-radius: 6px;
            border: none;
            outline: none;
            font-size: 14px;
        }

        .search-input::placeholder {
            color: #999;
            font-size: 13px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-weight: bold;
            font-size: 13px;
            cursor: pointer;
            margin-left: 10px;
            white-space: nowrap;
        }

        .btn-fetch {
            background-color: #ffc107;
            color: #333;
        }

        .btn-fetch:hover {
            background-color: #ffb300;
        }

        .btn-fetch:disabled {
            background-color: #ddd;
            cursor: not-allowed;
        }

        .btn-view {
            background-color: white;
            color: #1a73e8;
        }

        .btn-view:hover {
            background-color: #f1f1f1;
        }

        .btn-view.active {
            background-color: #1557b0;
            color: white;
        }

        .btn-bookmark {
            background-color: white;
            color: #1a73e8;
        }

        .btn-bookmark:hover {
            background-color: #f1f1f1;
        }

        .btn-bookmark.active {
            background-color: #1557b0;
            color: white;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .news-list-container {
            width: 400px;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            background-color: #f8f9fa;
        }

        .news-list-header {
            padding: 15px 20px;
            background-color: white;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            font-size: 16px;
        }

        .news-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .news-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .news-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-color: #1a73e8;
        }

        .news-item.active {
            background-color: #e3f2fd;
            border-color: #1a73e8;
        }

        .news-item-title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
            color: #333;
            line-height: 1.4;
        }

        .news-item-desc {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .news-item-date {
            font-size: 11px;
            color: #999;
        }

        .news-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bookmark-icon {
            cursor: pointer;
            font-size: 18px;
            color: #ccc;
            transition: color 0.2s;
        }

        .bookmark-icon.bookmarked {
            color: #ffc107;
        }

        .bookmark-icon:hover {
            color: #ffb300;
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            font-size: 14px;
            padding: 20px;
            text-align: center;
        }

        .news-detail-container {
            flex: 1;
            overflow-y: auto;
            background-color: white;
        }

        .news-detail {
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }

        .news-detail-title {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            line-height: 1.4;
            margin-bottom: 20px;
        }

        .news-detail-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            padding-bottom: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            flex-wrap: wrap;
        }

        .news-detail-bookmark {
            cursor: pointer;
            font-size: 24px;
            color: #ccc;
            transition: color 0.2s;
            user-select: none;
        }

        .news-detail-bookmark.bookmarked {
            color: #ffc107;
        }

        .news-detail-bookmark:hover {
            color: #ffb300;
        }

        .news-detail-date {
            color: #666;
            font-size: 14px;
        }

        .news-detail-link {
            display: inline-block;
            padding: 8px 16px;
            background-color: #1a73e8;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .news-detail-link:hover {
            background-color: #1557b0;
        }

        .news-detail-content {
            font-size: 16px;
            line-height: 1.8;
            color: #333;
            white-space: pre-wrap;
        }

        .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            font-size: 16px;
            text-align: center;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="search-container">
        <div class="brand">
            <span class="brand-icon"></span>
            SSAFY 뉴스 검색기
        </div>

        <input type="text" 
               class="search-input" 
               placeholder="검색어를 입력하세요 (예: 인공지능, 금융, SSAFY)">

        <button class="btn btn-fetch">가져오기</button>

        <button class="btn btn-view active" id="btnViewAll">전체 보기</button>

        <button class="btn btn-bookmark" id="btnViewBookmark">북마크 보기</button>
    </div>

    <div class="main-content">
        <div class="news-list-container">
            <div class="news-list-header">
                뉴스 목록 (<span id="news-count">0</span>)
            </div>
            <div class="news-list" id="newsList">
                <div class="loading">뉴스를 불러오는 중...</div>
            </div>
        </div>

        <div class="news-detail-container" id="newsDetail">
            <div class="placeholder">좌측에서 뉴스를 선택하세요.</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        const csrftoken = getCookie('csrftoken');
        let selectedNewsId = null;
        let currentViewMode = 'all'; // 'all' 또는 'bookmarked'

        async function loadNewsList(mode = 'all') {
            const newsListEl = document.getElementById('newsList');
            const newsCountEl = document.getElementById('news-count');

            try {
                const url = mode === 'all' ? '/news/view-all/' : '/news/bookmarked/';
                const response = await axios.get(url);
                const newsList = response.data.news;

                newsCountEl.textContent = newsList.length;

                if (newsList.length === 0) {
                    const emptyMessage = mode === 'all' 
                        ? '아직 저장된 기사가 없습니다.<br>검색어를 입력하고 "가져오기"를 클릭하세요.'
                        : '북마크된 뉴스가 없습니다.<br>별표를 클릭하여 북마크를 추가하세요.';
                    newsListEl.innerHTML = `<div class="empty-state">${emptyMessage}</div>`;
                    return;
                }

                let html = '';
                newsList.forEach(news => {
                    const bookmarkClass = news.is_bookmarked ? 'bookmarked' : '';
                    const bookmarkIcon = news.is_bookmarked ? '★' : '☆';
                    
                    html += `
                        <div class="news-item" data-id="${news.id}">
                            <div class="news-item-title">${news.title}</div>
                            <div class="news-item-desc">${news.description}</div>
                            <div class="news-item-footer">
                                <div class="news-item-date">${news.created_at}</div>
                                <span class="bookmark-icon ${bookmarkClass}" data-id="${news.id}" onclick="toggleBookmark(event, ${news.id})">${bookmarkIcon}</span>
                            </div>
                        </div>
                    `;
                });

                newsListEl.innerHTML = html;

                document.querySelectorAll('.news-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const newsId = this.dataset.id;
                        loadNewsDetail(newsId);
                        
                        document.querySelectorAll('.news-item').forEach(el => el.classList.remove('active'));
                        this.classList.add('active');
                    });
                });

            } catch (error) {
                newsListEl.innerHTML = '<div class="empty-state">뉴스 목록을 불러오는데 실패했습니다.</div>';
                console.error('Error loading news:', error);
            }
        }

        async function loadNewsDetail(newsId) {
            const detailEl = document.getElementById('newsDetail');
            
            detailEl.innerHTML = '<div class="loading">뉴스를 불러오는 중...</div>';

            try {
                const response = await axios.get(`/news/detail/${newsId}/`);
                const news = response.data.news;

                const bookmarkClass = news.is_bookmarked ? 'bookmarked' : '';
                const bookmarkIcon = news.is_bookmarked ? '★' : '☆';
                
                const html = `
                    <div class="news-detail">
                        <h1 class="news-detail-title">${news.title}</h1>
                        <div class="news-detail-meta">
                            <span class="news-detail-date">발행일: ${news.created_at}</span>
                            <a href="${news.link}" target="_blank" class="news-detail-link">원문 보기</a>
                            <span class="news-detail-bookmark ${bookmarkClass}" onclick="toggleBookmarkDetail(${news.id})" title="북마크">${bookmarkIcon}</span>
                        </div>
                        <div class="news-detail-content">${news.description}</div>
                    </div>
                `;

                detailEl.innerHTML = html;
                detailEl.scrollTop = 0;

            } catch (error) {
                detailEl.innerHTML = '<div class="placeholder">뉴스를 불러오는데 실패했습니다.</div>';
                console.error('Error loading news detail:', error);
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            loadNewsList('all');
        });

        async function toggleBookmark(event, newsId) {
            event.stopPropagation();
            
            try {
                const response = await axios.post(`/news/bookmark/${newsId}/`, {}, {
                    headers: {
                        'X-CSRFToken': csrftoken
                    }
                });

                if (response.data.success) {
                    // 현재 보기 모드에 따라 리스트 새로고침
                    loadNewsList(currentViewMode);

                    // 상세보기도 업데이트
                    const detailBookmark = document.querySelector('.news-detail-bookmark');
                    if (detailBookmark) {
                        if (response.data.is_bookmarked) {
                            detailBookmark.classList.add('bookmarked');
                            detailBookmark.textContent = '★';
                        } else {
                            detailBookmark.classList.remove('bookmarked');
                            detailBookmark.textContent = '☆';
                        }
                    }
                }
            } catch (error) {
                alert('북마크 처리 중 오류가 발생했습니다.');
                console.error('Bookmark error:', error);
            }
        }

        async function toggleBookmarkDetail(newsId) {
            try {
                const response = await axios.post(`/news/bookmark/${newsId}/`, {}, {
                    headers: {
                        'X-CSRFToken': csrftoken
                    }
                });

                if (response.data.success) {
                    // 현재 보기 모드에 따라 리스트 새로고침
                    loadNewsList(currentViewMode);

                    const detailBookmark = document.querySelector('.news-detail-bookmark');
                    if (response.data.is_bookmarked) {
                        detailBookmark.classList.add('bookmarked');
                        detailBookmark.textContent = '★';
                    } else {
                        detailBookmark.classList.remove('bookmarked');
                        detailBookmark.textContent = '☆';
                    }
                }
            } catch (error) {
                alert('북마크 처리 중 오류가 발생했습니다.');
                console.error('Bookmark error:', error);
            }
        }

        document.querySelector('.btn-fetch').addEventListener('click', async function() {
            const query = document.querySelector('.search-input').value.trim();
            
            if (!query) {
                alert('검색어를 입력해주세요.');
                return;
            }

            this.disabled = true;
            this.textContent = '가져오는 중...';

            try {
                const response = await axios.post('/news/fetch-news/', {
                    query: query
                }, {
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    }
                });

                if (response.data.success) {
                    alert(response.data.message);
                    document.querySelector('.search-input').value = '';
                    
                    // 전체 보기 모드로 전환하고 리스트 새로고침
                    currentViewMode = 'all';
                    document.getElementById('btnViewAll').classList.add('active');
                    document.getElementById('btnViewBookmark').classList.remove('active');
                    loadNewsList('all');
                }
            } catch (error) {
                alert('오류가 발생했습니다: ' + (error.response?.data?.error || error.message));
            } finally {
                this.disabled = false;
                this.textContent = '가져오기';
            }
        });

        // 전체 보기 버튼
        document.getElementById('btnViewAll').addEventListener('click', function() {
            currentViewMode = 'all';
            this.classList.add('active');
            document.getElementById('btnViewBookmark').classList.remove('active');
            loadNewsList('all');
        });

        // 북마크 보기 버튼
        document.getElementById('btnViewBookmark').addEventListener('click', function() {
            currentViewMode = 'bookmarked';
            this.classList.add('active');
            document.getElementById('btnViewAll').classList.remove('active');
            loadNewsList('bookmarked');
        });
    </script>
</body>
</html>